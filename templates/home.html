{% extends "base.html" %}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
crossorigin=""/>    
{% block content %}
<div class="container mt-4">
    {% if trips %}
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="mb-0">Trips</h1>
        <div class="btn-group" role="group" aria-label="View switch">
            <button id="listViewBtn" class="btn btn-outline-primary active">
                <i class="fas fa-list"></i> List View
            </button>
            <button id="mapViewBtn" class="btn btn-outline-secondary">
                <i class="fas fa-map"></i> Map View
            </button>
        </div>
    </div>
    
    <div id="listView" class="row">
        {% for trip in trips %}
        <div class="col-md-4 mb-4">
            <div class="card trip-card">
                <div class="card-img-top-container">
                    <img src="{{ url_for('static', filename='trip_pics/' ~ trip.photo_file) }}" class="card-img-top" alt="{{ trip.name }}">
                </div>
                <div class="card-body d-flex flex-column">
                    <h5 class="card-title">{{ trip.name }}</h5>
                    <p class="card-text"><strong>Destination:</strong> {{ trip.destination }}</p>
                    <!-- <p class="card-text"><strong>Start Date:</strong> {{ trip.start_date }}</p> -->
                    <p><strong>Start Date:</strong> {{ trip.start_date.strftime('%Y-%m-%d %H:%M') }}</p>
                    <a href="{{ url_for('trip', trip_id=trip.id) }}" class="btn btn-primary mt-auto">View Trip</a>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    
    <div id="mapView" class="map-container" style="display: none;">
        <div id="map" style="height: 100%; width: 100%;"></div>
    </div>
    
    {% else %}
    <div class="jumbotron jumbotron-custom text-center bg-dark text-white">
        <div>
            <h1 class="display-4">Plan Your Next Adventure</h1>
            <p class="lead">Discover new places, plan with friends, and make memories. Join us today!</p>
            <hr class="my-4">
            <p class="lead">
                <a class="btn btn-primary btn-lg mr-2" href="{{ url_for('login') }}" role="button">Log In</a>
                <a class="btn btn-success btn-lg ml-2" href="{{ url_for('register') }}" role="button">Sign Up</a>
            </p>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block scripts %}
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const listViewBtn = document.getElementById('listViewBtn');
        const mapViewBtn = document.getElementById('mapViewBtn');
        const listView = document.getElementById('listView');
        const mapView = document.getElementById('mapView');
    
        let map;
        let mapInitialized = false;
    
        listViewBtn.addEventListener('click', function() {
            listView.style.display = 'flex';
            mapView.style.display = 'none';
            listViewBtn.classList.add('active');
            mapViewBtn.classList.remove('active');
        });
    
        mapViewBtn.addEventListener('click', function() {
            listView.style.display = 'none';
            mapView.style.display = 'block';
            listViewBtn.classList.remove('active');
            mapViewBtn.classList.add('active');
    
            if (!mapInitialized) {
                initMap();
                mapInitialized = true;
            }
        });
    
        function initMap() {
            const southWest = L.latLng(-140, -240);
            const northEast = L.latLng(140, 240);
            const bounds = L.latLngBounds(southWest, northEast);
    
            map = L.map('map', {
                maxBounds: bounds,
                maxBoundsViscosity: 1.0
            }).setView([40, 0], 2);
    
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 19,
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);
    
            const trips = {{ trips|tojson|safe }};
    
            trips.forEach((trip) => {
                const marker = L.marker([trip.latitude, trip.longitude]).addTo(map);
                const popupContent = `<b><a href="/trip/${trip.id}">${trip.name}</a></b><br>${trip.destination}`;
                const popup = L.popup({ offset: [0, -20] }).setContent(popupContent);
    
                marker.on('mouseover', function() {
                    popup.setLatLng(marker.getLatLng()).openOn(map);
                });
            });
        }
    });
</script>

    
    
    
{% endblock %}

<style>
.map-container {
    height: 500px; /* Fixed height for the map container */
    width: 100%; /* Full width */
    border: 2px solid #ddd;
    border-radius: 10px;
    padding: 10px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

.btn-group .btn {
    border-radius: 0;
}

.btn-group .btn:first-child {
    border-top-left-radius: 5px;
    border-bottom-left-radius: 5px;
}

.btn-group .btn:last-child {
    border-top-right-radius: 5px;
    border-bottom-right-radius: 5px;
}
</style>
